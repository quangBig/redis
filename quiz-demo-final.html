<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz System - Multi Quiz Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .answer-option { transition: all 0.3s ease; }
        .answer-option:hover { transform: translateY(-2px); }
        .answer-option.selected { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.05);
        }
        .rank-item {
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .quiz-card {
            transition: all 0.3s ease;
        }
        .quiz-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen">
    <div class="container mx-auto p-4 max-w-7xl">
        <!-- Header with Tab Navigation -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h1 class="text-3xl font-bold text-center mb-6 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                <i class="fas fa-brain"></i> Multi-Quiz Competition System
            </h1>
            
            <!-- Tab Buttons -->
            <div class="flex justify-center space-x-4 mb-6">
                <button onclick="switchTab('admin')" id="adminTab" 
                        class="px-6 py-3 rounded-lg font-semibold transition-all duration-300 bg-blue-600 text-white">
                    <i class="fas fa-user-shield mr-2"></i>Admin Panel
                </button>
                <button onclick="switchTab('user')" id="userTab" 
                        class="px-6 py-3 rounded-lg font-semibold transition-all duration-300 bg-gray-200 text-gray-700">
                    <i class="fas fa-user mr-2"></i>User Interface
                </button>
            </div>
        </div>

        <!-- ADMIN PANEL -->
        <div id="adminContent" class="tab-content active">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Quiz Management -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold mb-4 text-blue-600">
                        <i class="fas fa-cogs"></i> Quiz Management
                    </h2>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">T√™n Quiz:</label>
                        <input type="text" id="quizTitle" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none" 
                               placeholder="Nh·∫≠p t√™n quiz (v√≠ d·ª•: L·ªãch s·ª≠ Vi·ªát Nam)" />
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Danh s√°ch c√¢u h·ªèi:</label>
                        <div id="questionsContainer" class="max-h-96 overflow-y-auto space-y-3">
                            <!-- Questions will be added here -->
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="addQuestion()" class="flex-1 bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                                <i class="fas fa-plus"></i> Th√™m C√¢u H·ªèi
                            </button>
                            <button onclick="createQuiz()" class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                <i class="fas fa-rocket"></i> T·∫°o Quiz
                            </button>
                        </div>
                    </div>

                    <div id="createResult" class="mt-4 p-4 rounded-lg hidden"></div>
                </div>

                <!-- Quiz Control & List -->
                <div class="space-y-6">
                    <!-- All Quizzes -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-2xl font-bold mb-4 text-green-600">
                            <i class="fas fa-list"></i> Danh S√°ch Quiz
                        </h2>
                        
                        <button onclick="loadAllQuizzes()" class="w-full bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors mb-4">
                            <i class="fas fa-sync"></i> T·∫£i Danh S√°ch
                        </button>
                        
                        <div id="allQuizzes" class="space-y-3 max-h-64 overflow-y-auto">
                            <div class="text-center text-gray-500 py-4">
                                <i class="fas fa-info-circle text-2xl mb-2"></i>
                                <p>Ch∆∞a c√≥ quiz n√†o</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quiz Control -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-2xl font-bold mb-4 text-orange-600">
                            <i class="fas fa-gamepad"></i> Quiz Control
                        </h2>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Quiz ID:</label>
                                <input type="text" id="controlQuizId" placeholder="Nh·∫≠p Quiz ID" 
                                       class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-orange-500 focus:outline-none">
                            </div>
                            
                            <div class="grid grid-cols-2 gap-3">
                                <button onclick="startQuiz()" class="bg-green-500 text-white px-4 py-3 rounded-lg hover:bg-green-600 transition-colors">
                                    <i class="fas fa-play"></i> B·∫Øt ƒê·∫ßu
                                </button>
                                <button onclick="endQuiz()" class="bg-red-500 text-white px-4 py-3 rounded-lg hover:bg-red-600 transition-colors">
                                    <i class="fas fa-stop"></i> K·∫øt Th√∫c
                                </button>
                            </div>
                            
                            <button onclick="getAdminLeaderboard()" class="w-full bg-yellow-500 text-white px-4 py-3 rounded-lg hover:bg-yellow-600 transition-colors">
                                <i class="fas fa-trophy"></i> Xem B·∫£ng X·∫øp H·∫°ng
                            </button>
                        </div>

                        <div id="adminResult" class="mt-4 p-4 rounded-lg hidden"></div>
                        <div id="adminLeaderboard" class="mt-4 hidden"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- USER INTERFACE -->
        <div id="userContent" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Join Quiz -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold mb-4 text-purple-600">
                        <i class="fas fa-sign-in-alt"></i> Tham Gia Quiz
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">T√™n Quiz:</label>
                            <input type="text" id="quizTitleInput" placeholder="Nh·∫≠p t√™n quiz (v√≠ d·ª•: L·ªãch s·ª≠ Vi·ªát Nam)" 
                                   class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none">
                        </div>
                        
                        <button onclick="findQuizByName()" class="w-full bg-indigo-500 text-white px-4 py-2 rounded-lg hover:bg-indigo-600 transition-colors">
                            <i class="fas fa-search"></i> T√¨m Quiz
                        </button>
                        
                        <div id="foundQuiz" class="hidden">
                            <div class="p-3 bg-green-50 border border-green-200 rounded-lg">
                                <p class="text-sm text-green-700">Quiz t√¨m th·∫•y!</p>
                                <p class="font-semibold" id="foundQuizTitle"></p>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">T√™n c·ªßa b·∫°n:</label>
                            <input type="text" id="userName" placeholder="Nh·∫≠p t√™n ng∆∞·ªùi ch∆°i" 
                                   class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none">
                        </div>
                        
                        <button onclick="joinQuiz()" class="w-full bg-purple-600 text-white px-4 py-3 rounded-lg hover:bg-purple-700 transition-colors" id="joinBtn" disabled>
                            <i class="fas fa-user-plus"></i> Tham Gia Ngay
                        </button>
                    </div>

                    <div id="joinResult" class="mt-4 p-4 rounded-lg hidden"></div>
                </div>

                <!-- Quiz Questions -->
                <div class="lg:col-span-2 bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold mb-4 text-indigo-600">
                        <i class="fas fa-question-circle"></i> C√¢u H·ªèi
                        <span id="currentQuizName" class="ml-3 text-lg font-normal text-gray-600"></span>
                    </h2>
                    
                    <div id="quizStatus" class="mb-4 p-3 bg-blue-50 rounded-lg hidden">
                        <div class="flex justify-between items-center">
                            <span class="font-semibold">Quiz ƒëang di·ªÖn ra!</span>
                            <span id="timeRemaining" class="text-blue-600 font-bold"></span>
                        </div>
                    </div>

                    <div id="questionsContainer" class="space-y-6">
                        <div class="text-center text-gray-500 py-8">
                            <i class="fas fa-info-circle text-4xl mb-3"></i>
                            <p>Vui l√≤ng tham gia quiz ƒë·ªÉ xem c√¢u h·ªèi</p>
                        </div>
                    </div>

                    <button onclick="submitAllAnswers()" id="submitBtn" 
                            class="w-full mt-6 bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors hidden">
                        <i class="fas fa-paper-plane"></i> N·ªôp B√†i
                    </button>

                    <div id="answerResult" class="mt-4 p-4 rounded-lg hidden"></div>
                </div>
            </div>

            <!-- Live Ranking (Always visible at bottom) -->
            <div class="mt-6 bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold mb-4 text-yellow-600">
                    <i class="fas fa-crown"></i> B·∫£ng X·∫øp H·∫°ng Real-time
                    <span class="pulse inline-block ml-2 text-sm bg-green-100 text-green-600 px-2 py-1 rounded-full">LIVE</span>
                    <span id="leaderboardQuizName" class="ml-3 text-lg font-normal text-gray-600"></span>
                </h2>
                
                <div id="userLeaderboard" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="text-center text-gray-500 py-8 md:col-span-2 lg:col-span-3">
                        <i class="fas fa-trophy text-4xl mb-3"></i>
                        <p>Ch∆∞a c√≥ d·ªØ li·ªáu x·∫øp h·∫°ng</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentQuizId = '';
        let currentQuizTitle = '';
        let questionCount = 1;
        let leaderboardInterval = null;
        let timeInterval = null;

        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('[id$="Tab"]').forEach(button => {
                button.classList.remove('bg-blue-600', 'text-white');
                button.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            document.getElementById(tab + 'Content').classList.add('active');
            document.getElementById(tab + 'Tab').classList.remove('bg-gray-200', 'text-gray-700');
            document.getElementById(tab + 'Tab').classList.add('bg-blue-600', 'text-white');
        }

        // Admin functions
        function addQuestion() {
            questionCount++;
            const container = document.getElementById('questionsContainer');
            const questionHtml = `
                <div class="question-item border-2 border-gray-200 p-4 rounded-lg hover:border-blue-300 transition-colors">
                    <div class="flex justify-between items-start mb-3">
                        <span class="font-semibold text-blue-600">C√¢u ${questionCount}:</span>
                        <button onclick="removeQuestion(this)" class="text-red-500 hover:text-red-700">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <input type="text" placeholder="Nh·∫≠p c√¢u h·ªèi" class="w-full p-2 mb-3 border rounded question-text">
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <input type="text" placeholder="ƒê√°p √°n A" class="p-2 border rounded option-0">
                        <input type="text" placeholder="ƒê√°p √°n B" class="p-2 border rounded option-1">
                        <input type="text" placeholder="ƒê√°p √°n C" class="p-2 border rounded option-2">
                        <input type="text" placeholder="ƒê√°p √°n D" class="p-2 border rounded option-3">
                    </div>
                    <select class="p-2 border rounded correct-answer">
                        <option value="0">A</option>
                        <option value="1">B</option>
                        <option value="2">C</option>
                        <option value="3">D</option>
                    </select>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', questionHtml);
        }

        function removeQuestion(button) {
            button.closest('.question-item').remove();
        }

        async function createQuiz() {
            const title = document.getElementById('quizTitle').value;
            const questions = [];
            
            document.querySelectorAll('.question-item').forEach(item => {
                const questionText = item.querySelector('.question-text').value;
                const options = [
                    item.querySelector('.option-0').value,
                    item.querySelector('.option-1').value,
                    item.querySelector('.option-2').value,
                    item.querySelector('.option-3').value
                ];
                const correctAnswer = parseInt(item.querySelector('.correct-answer').value);
                
                if (questionText && options.every(opt => opt)) {
                    questions.push({ question: questionText, options, correctAnswer });
                }
            });

            try {
                const response = await fetch('http://localhost:3000/quiz/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title, questions })
                });
                
                const result = await response.json();
                currentQuizId = result.quizId;
                
                showResult('createResult', `‚úÖ Quiz "${title}" created successfully! ID: ${result.quizId}`, 'success');
                document.getElementById('controlQuizId').value = result.quizId;
                
                // Clear form
                document.getElementById('quizTitle').value = '';
                document.getElementById('questionsContainer').innerHTML = '';
                questionCount = 0;
                
                // Reload quiz list
                loadAllQuizzes();
            } catch (error) {
                showResult('createResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function loadAllQuizzes() {
            try {
                const response = await fetch('http://localhost:3000/quiz/list');
                const quizzes = await response.json();
                
                const container = document.getElementById('allQuizzes');
                if (quizzes.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-gray-500 py-4">
                            <i class="fas fa-info-circle text-2xl mb-2"></i>
                            <p>Ch∆∞a c√≥ quiz n√†o</p>
                        </div>
                    `;
                } else {
                    container.innerHTML = quizzes.map(quiz => `
                        <div class="quiz-card border-2 border-gray-200 p-3 rounded-lg cursor-pointer hover:border-blue-400"
                             onclick="selectQuizForControl('${quiz.id}', '${quiz.title}')">
                            <div class="flex justify-between items-center">
                                <div>
                                    <div class="font-semibold text-blue-600">${quiz.title}</div>
                                    <div class="text-xs text-gray-500">ID: ${quiz.id}</div>
                                </div>
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading quizzes:', error);
            }
        }

        function selectQuizForControl(quizId, title) {
            document.getElementById('controlQuizId').value = quizId;
            showResult('adminResult', `‚úÖ ƒê√£ ch·ªçn quiz: ${title}`, 'success');
        }

        async function startQuiz() {
            const quizId = document.getElementById('controlQuizId').value;
            try {
                const response = await fetch(`http://localhost:3000/quiz/${quizId}/start`, {
                    method: 'POST'
                });
                const result = await response.json();
                showResult('adminResult', `‚úÖ ${result.message}`, 'success');
            } catch (error) {
                showResult('adminResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function endQuiz() {
            const quizId = document.getElementById('controlQuizId').value;
            try {
                const response = await fetch(`http://localhost:3000/quiz/${quizId}/end`, {
                    method: 'POST'
                });
                const result = await response.json();
                showResult('adminResult', `‚úÖ ${result.message}`, 'success');
            } catch (error) {
                showResult('adminResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function getAdminLeaderboard() {
            const quizId = document.getElementById('controlQuizId').value;
            await displayLeaderboard(quizId, 'adminLeaderboard');
        }

        // User functions
        async function findQuizByName() {
            const quizTitle = document.getElementById('quizTitleInput').value;
            
            try {
                const response = await fetch(`http://localhost:3000/quiz/find?title=${encodeURIComponent(quizTitle)}`);
                
                if (response.status === 404) {
                    document.getElementById('foundQuiz').classList.add('hidden');
                    document.getElementById('joinBtn').disabled = true;
                    showResult('joinResult', `‚ùå Kh√¥ng t√¨m th·∫•y quiz: ${quizTitle}`, 'error');
                    return;
                }
                
                if (!response.ok) {
                    throw new Error(`HTTP error: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.quizId) {
                    currentQuizId = result.quizId;
                    currentQuizTitle = quizTitle;
                    
                    document.getElementById('foundQuiz').classList.remove('hidden');
                    document.getElementById('foundQuizTitle').textContent = quizTitle;
                    document.getElementById('joinBtn').disabled = false;
                    
                    showResult('joinResult', `‚úÖ T√¨m th·∫•y quiz: ${quizTitle}`, 'success');
                }
            } catch (error) {
                document.getElementById('foundQuiz').classList.add('hidden');
                document.getElementById('joinBtn').disabled = true;
                showResult('joinResult', `‚ùå L·ªói: ${error.message}`, 'error');
            }
        }

        async function joinQuiz() {
            const userName = document.getElementById('userName').value;
            
            if (!currentQuizId || !userName) {
                showResult('joinResult', '‚ùå Vui l√≤ng t√¨m quiz v√† nh·∫≠p t√™n!', 'error');
                return;
            }
            
            try {
                const response = await fetch('http://localhost:3000/quiz/join', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ quizId: currentQuizId, userName })
                });
                
                const result = await response.json();
                showResult('joinResult', `‚úÖ ${result.message}`, 'success');
                
                // Update UI with quiz name
                document.getElementById('currentQuizName').textContent = `- ${currentQuizTitle}`;
                document.getElementById('leaderboardQuizName').textContent = `- ${currentQuizTitle}`;
                
                // Load questions and start live updates
                await loadQuestions(currentQuizId);
                startLiveUpdates(currentQuizId);
            } catch (error) {
                showResult('joinResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function loadQuestions(quizId) {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '<p class="text-center text-gray-500">ƒêang t·∫£i c√¢u h·ªèi...</p>';
            
            try {
                let questionsHtml = '';
                let questionIndex = 0;
                let hasQuestions = false;
                
                // First get quiz info to know how many questions
                const quizResponse = await fetch(`http://localhost:3000/quiz/${quizId}`);
                if (!quizResponse.ok) {
                    container.innerHTML = '<p class="text-center text-red-500">Kh√¥ng th·ªÉ t·∫£i th√¥ng tin quiz!</p>';
                    return;
                }
                
                const quiz = await quizResponse.json();
                if (!quiz || !quiz.isActive) {
                    container.innerHTML = '<p class="text-center text-yellow-500">Quiz ch∆∞a ƒë∆∞·ª£c b·∫Øt ƒë·∫ßu ho·∫∑c ƒë√£ k·∫øt th√∫c!</p>';
                    return;
                }
                
                // Load questions until no more available
                while (true) {
                    const response = await fetch(`http://localhost:3000/quiz/${quizId}/question/${questionIndex}`);
                    
                    if (response.status === 404) {
                        console.log(`No more questions at index ${questionIndex}`);
                        break; // No more questions
                    }
                    
                    if (!response.ok) {
                        console.error(`HTTP error: ${response.status} ${response.statusText}`);
                        break;
                    }
                    
                    const question = await response.json();
                    
                    if (!question || !question.question) {
                        break; // No more questions
                    }
                    
                    hasQuestions = true;
                    questionsHtml += `
                        <div class="question-group border-2 border-gray-200 p-4 rounded-lg">
                            <h3 class="font-bold text-lg mb-4 text-indigo-600">
                                <span class="bg-indigo-100 text-indigo-600 px-2 py-1 rounded mr-2">C√¢u ${questionIndex + 1}</span>
                                ${question.question}
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                ${question.options.map((opt, idx) => `
                                    <div class="answer-option border-2 border-gray-200 p-3 rounded-lg cursor-pointer hover:border-indigo-400 hover:bg-indigo-50"
                                         onclick="selectAnswer(this, ${questionIndex}, ${idx})">
                                        <span class="font-semibold mr-2">${String.fromCharCode(65 + idx)}.</span>
                                        ${opt}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    
                    questionIndex++;
                    
                    // Safety limit to prevent infinite loop
                    if (questionIndex >= 10) break;
                }
                
                if (!hasQuestions) {
                    container.innerHTML = '<p class="text-center text-red-500">Quiz n√†y ch∆∞a c√≥ c√¢u h·ªèi n√†o!</p>';
                } else {
                    container.innerHTML = questionsHtml;
                    document.getElementById('submitBtn').classList.remove('hidden');
                    document.getElementById('quizStatus').classList.remove('hidden');
                }
                
            } catch (error) {
                console.error('Error loading questions:', error);
                container.innerHTML = '<p class="text-center text-red-500">Kh√¥ng th·ªÉ t·∫£i c√¢u h·ªèi. Vui l√≤ng ki·ªÉm tra l·∫°i quiz!</p>';
            }
        }

        function selectAnswer(element, questionIndex, answerIndex) {
            // Remove previous selection in same question group
            const questionGroup = element.closest('.question-group');
            questionGroup.querySelectorAll('.answer-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Add selection to clicked element
            element.classList.add('selected');
            
            // Store answer
            if (!window.userAnswers) window.userAnswers = {};
            window.userAnswers[questionIndex] = answerIndex;
        }

        async function submitAllAnswers() {
            const userName = document.getElementById('userName').value;
            
            if (!window.userAnswers || Object.keys(window.userAnswers).length === 0) {
                showResult('answerResult', '‚ùå Vui l√≤ng tr·∫£ l·ªùi √≠t nh·∫•t m·ªôt c√¢u h·ªèi!', 'error');
                return;
            }
            
            try {
                let correctCount = 0;
                const results = [];
                
                for (const [questionIndex, answerIndex] of Object.entries(window.userAnswers)) {
                    const response = await fetch('http://localhost:3000/quiz/submit-answer', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            quizId: currentQuizId,
                            questionIndex: parseInt(questionIndex),
                            answer: answerIndex,
                            userName
                        })
                    });
                    
                    const result = await response.json();
                    if (result.isCorrect) correctCount++;
                    results.push(`C√¢u ${parseInt(questionIndex) + 1}: ${result.isCorrect ? '‚úÖ ƒê√∫ng' : '‚ùå Sai'}`);
                }
                
                showResult('answerResult', `
                    <div class="font-semibold mb-2">üìä K·∫øt qu·∫£:</div>
                    ${results.join('<br>')}
                    <div class="mt-3 text-lg font-bold text-green-600">üèÜ T·ªïng ƒëi·ªÉm: ${correctCount * 10}</div>
                `, 'success');
                
                document.getElementById('submitBtn').disabled = true;
                
            } catch (error) {
                showResult('answerResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        // Live updates
        function startLiveUpdates(quizId) {
            // Update leaderboard every 3 seconds
            if (leaderboardInterval) clearInterval(leaderboardInterval);
            leaderboardInterval = setInterval(() => {
                displayLeaderboard(quizId, 'userLeaderboard');
            }, 3000);
            
            // Update time every second
            if (timeInterval) clearInterval(timeInterval);
            timeInterval = setInterval(() => {
                updateQuizTime(quizId);
            }, 1000);
        }

        async function displayLeaderboard(quizId, targetId) {
            try {
                const response = await fetch(`http://localhost:3000/quiz/${quizId}/leaderboard`);
                const leaderboard = await response.json();
                
                let html = '';
                if (leaderboard.rankings && leaderboard.rankings.length > 0) {
                    leaderboard.rankings.slice(0, 9).forEach((entry, index) => {
                        const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üèÖ';
                        const bgColor = index === 0 ? 'bg-yellow-50 border-yellow-300' : 
                                     index === 1 ? 'bg-gray-50 border-gray-300' : 
                                     index === 2 ? 'bg-orange-50 border-orange-300' : 'bg-white border-gray-200';
                        
                        html += `
                            <div class="rank-item border-2 ${bgColor} p-4 rounded-lg flex justify-between items-center">
                                <div class="flex items-center">
                                    <span class="text-2xl mr-3">${medal}</span>
                                    <div>
                                        <div class="font-semibold">${entry.userName}</div>
                                        <div class="text-sm text-gray-500">Rank #${entry.rank}</div>
                                    </div>
                                </div>
                                <div class="text-2xl font-bold ${index < 3 ? 'text-yellow-600' : 'text-gray-600'}">
                                    ${entry.score} pts
                                </div>
                            </div>
                        `;
                    });
                } else {
                    html = `
                        <div class="text-center text-gray-500 py-8 md:col-span-2 lg:col-span-3">
                            <i class="fas fa-trophy text-4xl mb-3"></i>
                            <p>Ch∆∞a c√≥ ng∆∞·ªùi ch∆°i n√†o</p>
                        </div>
                    `;
                }
                
                document.getElementById(targetId).innerHTML = html;
                
            } catch (error) {
                console.error('Leaderboard error:', error);
            }
        }

        async function updateQuizTime(quizId) {
            try {
                const response = await fetch(`http://localhost:3000/quiz/${quizId}`);
                const quiz = await response.json();
                
                if (quiz && quiz.isActive) {
                    const minutes = Math.floor(quiz.timeRemaining / 60000);
                    const seconds = Math.floor((quiz.timeRemaining % 60000) / 1000);
                    document.getElementById('timeRemaining').textContent = 
                        `‚è∞ ${minutes}:${seconds.toString().padStart(2, '0')}`;
                }
            } catch (error) {
                // Ignore errors for time updates
            }
        }

        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = message;
            element.className = `mt-4 p-4 rounded-lg ${type === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`;
            element.classList.remove('hidden');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Add 2 sample questions
            addQuestion();
            addQuestion();
            
            // Load all quizzes on start
            loadAllQuizzes();
        });
    </script>
</body>
</html>
